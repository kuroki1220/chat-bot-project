社内用チャットボットを作成したい。

要件定義として、OpenAIのAPIキーを使用する。FileMakerProにチャットボットを導入して、copilotのようにどこの画面にでも出てくるようにしたい。形式は、Q＆Aデータが有るので、これをハッシュ化して組み込んでチャット形式にしたい。完全一致なキーワードだけではなく、学習して返答するようにしたい。そして付け加えるなら、協調フィルタリング機能のようなどういった問合せが多いかが分かるようにしたい。

APIキーの管理は、サーバー再度で管理をしたいです。中間サーバー？っていうのもいるなら作りたい。チャットロジックの開発？も必要なら。

使用する言語はなんでもいいけど、pythonやjava,html.css,javascriptなら助かる

開発環境はなんでもよい

開発の手順や何を準備したらいいか、コードやファイルの共有をして欲しいです。



# chatbot
社内用チャットボット構築にあたっての要件定義
WHO : 要件定義(黒木・石躍)、設計書(黒木)、プログラミング(黒木)、テスト・運用保守()、過程確認(石躍)、最終決定(社長さん)
WHAT : 社内用チャットボット
WHEN : 2026.4までに運用(社内用チャットボット)
WHERE : 最終：社外用ボットで特許取得
WHY : 生産性向上、従業員満足度向上　　外：DX化の推進、
HOW : フロントエンド(html,css)、中間サーバー＆サーバーサイド(Node.js、言語はpython)、VScode

<開発手順>
1. システム構成の決定と環境構築 : サーバー、データベース、開発言語などのインフラを確立する
2. APIキー管理サーバーの開発 : OpenAI APIキーを安全に管理し、チャットボットからのリクエストを仲介するサーバーの構築
3. Q＆Aデータの前処理と埋め込み : 既存のQ＆Aデータをチャットボットが理解できる形式に変換し、ベクトルデータベースに格納する。
4. チャットボットロジックの開発 : ユーザーからの問い合わせを処理し、OpenAI APIと連携して回答を生成するロジックを実装する
5. FileMaker Proとの連携インターフェース開発 : FileMaker Proからチャットボット機能を利用するためのUIと通信部分を実装する
6. 協調フィルタリング機能(問い合わせ分析)の実装 : 問合せデータを収収集・分析し、よくある質問などを可視化する仕組みを構築する
7. テストとデプロイ : 全体の動作確認を行い、本番環境にデプロイする


<準備するもの>
1. ソフトウェア・アカウント
・OpenAI APIキー : OpenAIアカウントを作成し、APIキーを取得する
・サーバー環境 : ・OS:Ubuntu, CentOs, ★windows Server、・Webサーバー:Nginx, ★Apache、・コンテナ環境:★Docker
・データベース : ・Q＆Aデータ保存用:☆PostgreSQL, ★MySQL, SQLite(リレーショナルデータベース)、・ベクトルデータ保存用:Chroma, Pinecone, Weaviate(ベクトルデータベース。★PstgreSQLのpgvector拡張機能でも代用可)
・開発言語の実行環境 : ★Python, Java
・FikeMaker Pro : 導入済みのFileMaker Pro環境
・バージョン管理システム : Git(★GitHub, GitLab, Bithucket)
2. データ
・既存Q＆Aデータ : 形式は問わないが、CSVやExcel、JSONなど、プログラムで扱いやすい形式に整理しておく


<各コンポーネントの詳細と開発指針>
1. APIキー管理サーバー(中間サーバー)
目的 : OpenAI APIキーを直接クライアントサイドに露出させることなく、安全に管理し、利用を仲介する。また、アクセス制限やレートリミット管理などの管理も追加できる。
言語 : Python(flask, FastAPI), Java(Spring Boot)
機能 : 
・APIキーの安全な保存:環境変数やセキュアな設定ファイルに保存する。
・OpenAI APIへのリクエスト転送:FileMaker Proからのリクエストを受け取り、APIキーを付与してOpenAI APIに送信する。
・レスポンスの転送:OpenAIからのレスポンスをFileMaker Proに返す。
・認証・認可:必要に応じて、FileMaker Proからのアクセスを制限するための認証機能を設ける。

2. Q＆Aデータの前処理と埋め込み(RAG)
目的 : 既存のQ＆Aデータをチャットボットが参照できるように、質問文をベクトル化し、ベクトルデータベースに格納する。ユーザーからの質問も同様にベクトル化し、最も類似度の高い質問(回答)をデータベースから検索して、OpenAIのプロンプトに含めることで、学習していない内容にも対応できるようにする。
言語 : Python
ライブラリ :
・テキスト処理:NLTK, spaCy
・ベクトル化:OpenAI Embeddings API, Sentence Transformers
・ベクトルデータベースクライアント:ChromaDB, Pinecone, FaissなどのPythonクライアントライブラリ
手順 : 
1. データの準備:Q＆Aデータを質問と回答のペアに整理する。
2. チャンキング(任意):回答が長い場合は、適切に分割する。
3. エンベディングの生成:各質問と回答をOpenAI Embeddings APIなどを使ってベクトル化する。
4. ベクトルデータベースへの格納:生成されたベクトルと元のQ＆Aのテキストをベクトルデータベースに格納する。

3. FileMaker Proへの組み込み
Copilotのようにどの画面にでも表示するには、Webビューアオブジェクトを使用するのが最も現実的。Webビューアに、上で開発するチャットボットのWebインターフェース(HTML/CSS/JavaScript)を表示させる。
必要な技術:HTML, CSS, JavaScript(フロントエンド)
手順:
1. チャットボットのWeb UI開発:
　・シンプルなHTMLページを作成し、CSSでデザイン、JavaScriptでチャットのやり取りと中間サーバーへAPIリクエストを実装する。
　・ユーザー入力フィールド、送信ボタン、チャット履歴表示エリアなどを作成する。
　・JavaScriptで、中間サーバーの/chatエンドポイントにXMKHttpRequestまたはFetch APIを使ってリクエストを送信し、レスポンスを表示する。
2. FIleMaker ProでのWebビューアの設定:
　・任意のレイアウトにWebビューアオブジェクトを配置する。
　・WebビューアのURLに、開発したチャットボットのWeb UIをホストするURLを指定する。(例: http://localhost:8080/chat.htmlや、デプロイ後のサーバーのURL)。
　・Webビューアの表示設定を調整し、常に前面に表示されるようにしたり、リサイズ可能にしたりする。
3. FileMakerスクリプトによる連携(任意):
　・FileMakerスクリプトを使って、特定のイベント(ボタンクリックなど)でWebビューアを更新したり、Webビューア内のJavaScriptとFileMakerのデータをやり取りしたりすることも可能。
　・Perform JavaScript in Web Viewer スクリプトステップや、URLパラメータ、fmp://プロトコルなどを活用する

4. 協調フィルタリング機能(問い合わせ分析)
目的:どのような問い合わせが多いか、ユーザーがどのような情報に興味を持っているかを分析し、Q＆Aデータの改善や、よくある質問(Q＆A)の自動生成に役立る。
実装方法:
1. ログデータの収集:
　・中間サーバーで、ユーザーからの問い合わせ内容、OpenAIからの回答、タイムスタンプ、可能で有ればユーザーIDなどをデータベースに保存する。
2. データの分析:
　・取集したログデータに対して、集計、キーワード抽出、トピックモデリングなどの分析を行う。
　・PythonのPandasやNLTK, spaCy,scikit-learnなどのライブラリが有用。
3. 可視化:
　・分析結果をWebインターフェース(管理画面など)でグラフや表で表示する
　・Streamlit, Dash, Tableau, Power BIなどのツールや、JavaScriptのD3.js, Chart.jsなどを使って可視化できる。


<開発環境とデプロイ>
開発環境
・ローカル開発:
　・Python(venvなどで仮想環境を構築)
　・Node.js(JavaScriptのツールチェイン用)
　・Docker(各サービスをコンテナ化して管理すると便利)
　・Visual Studio Code(推奨エディタ)
・Git:コードのバージョン管理とチームでの共有に必須。
デプロイ
・サーバー:AWS EC2, Google Cloud Compute Engine, Azure Virtual Machinesなどの仮想サーバー
・コンテナオーケストレーション:Docker Compose(小規模)、Kubernetes(大規模)
・Webサーバー:Nginx, Apache(中間サーバーへのリバースプロキシとして)


<開発の手順(まとめ)>
1. OpenAI APIキーの取得と環境変数への設定。
2. プロジェクトの初期設定:
　・Gitリポジトリの作成。
　・Python仮想環境の作成。
3. APIキー管理サーバー(中間サーバー)の開発:
　・FastAPIやFlaskを使って基本的なチャットエンドポイントを実装。
　・APIキーを安全に扱う仕組みを実装。
　・Dokerを使ってコンテナ化(任意だが推奨)
4. Q＆Aデータの前処理とベクトルデータベースへの格納:
　・既存Q&Aデータを整理し、Pythonスクリプトでベクトル化し、ChromaDBなどに格納するスクリプトを作成・実行。
　・中間サーバーのチャットロジックに、ベクトルデータベースからの検索とプロンプト組み込みの処理を追加。
5. FileMaker Pro向けWeb UIの開発:
　・HTML/CSS/JavaScriptでシンプルなチャットインターフェースを作成。
　・中間サーバーへのAPIリクエスト処理を実装。
6. FileMaker Proへの組み込み:
　・FileMaker ProのレイアウトにWebビューアを配置し、開発したWeb UIのURLを指定。
7. 問い合わせ分析機能の実装:
　・中間サーバーで問合せログをデータベースに保存する機能を実装。
　・ログデータを分析・可視化する簡易的なスクリプトやWebインターフェースを開発。
8. テスト:各機能の単体テスト、結合テスト、パフォーマンステスト。
9. デプロイ:開発した中間サーバーとWeb UIを本番サーバーにデプロイ。




・社内用チャットボット
・社外用チャットボット
・ボイス
